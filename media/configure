#!/bin/sh

cd "$(dirname "$(readlink -f "$0")")"
. ../.bin/misc/throw

[ -f .env ] || echo -e "cat <<END_OF_TEXT\n$(cat .env.template)\nEND_OF_TEXT" | sh > .env

read -p 'Finalize configuration? [y/N] ' -e 'answer'
[ "$answer" == 'y' ] || throw "Configuration aborted"

. .env

echo 'Creating missing directories...'
for directory in plex medusa radarr tautulli komga; do
	sudo -u "$UID" -- mkdir -p "$CONFIG/$directory"
done
for directory in books comics downloads/movies downloads/tvshows movies music tvshows; do
	sudo -u "$UID" -- mkdir -p "$MEDIA/$directory"
done

echo 'Containers configured successfully'
